{% extends "base.html" %}

{% block title %}Commands - Cowrie Honeypot{% endblock %}

{% block content %}
<div class="commands-page">
    <div class="page-header">
        <h1>Commands Executed</h1>
        <div class="filters">
            <form method="get" class="filter-form">
                <select name="hours" onchange="this.form.submit()">
                    <option value="24" {% if hours == 24 %}selected{% endif %}>Last 24 hours</option>
                    <option value="48" {% if hours == 48 %}selected{% endif %}>Last 48 hours</option>
                    <option value="168" {% if hours == 168 %}selected{% endif %}>Last 7 days</option>
                    <option value="720" {% if hours == 720 %}selected{% endif %}>Last 30 days</option>
                </select>
                <label>
                    <input type="checkbox" name="unique" value="1"
                           {% if unique == '1' %}checked{% endif %}
                           onchange="this.form.submit()">
                    Unique commands
                </label>
                <button type="submit">Filter</button>
            </form>
        </div>
    </div>

    <table class="data-table commands-table sortable">
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Command</th>
                <th>Source IP</th>
                <th>Session</th>
            </tr>
        </thead>
        <tbody>
            {% for cmd in commands %}
            <tr>
                <td>{{ cmd.timestamp | format_timestamp }}</td>
                <td><code>{{ cmd.command }}</code></td>
                <td>
                    <a href="{{ url_for('sessions', ip=cmd.src_ip, hours=hours) }}" class="ip-link">
                        <code>{{ cmd.src_ip }}</code>
                    </a>
                </td>
                <td>
                    <a href="{{ url_for('session_detail', session_id=cmd.session_id) }}" class="session-link">
                        {{ cmd.session_id | truncate_hash }}
                    </a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" class="no-data">No commands recorded in this period.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
