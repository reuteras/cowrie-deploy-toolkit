{% extends "base.html" %}

{% block title %}All Countries - Cowrie Honeypot{% endblock %}

{% block content %}
<div class="page">
    <div class="page-header">
        <h1>All Attacking Countries</h1>
        <div class="header-actions">
            <div class="time-filter">
                {% if available_sources %}
                <label>Source:</label>
                <select id="source-filter" onchange="updateFilters()">
                    <option value="" {% if not source_filter %}selected{% endif %}>All Honeypots</option>
                    {% for source_name in available_sources %}
                    <option value="{{ source_name }}" {% if source_filter == source_name %}selected{% endif %}>{{ source_name }}</option>
                    {% endfor %}
                </select>
                {% endif %}
                <label>Time range:</label>
                <select id="hours-filter" onchange="updateFilters()">
                    <option value="24" {% if hours == 24 %}selected{% endif %}>Last 24 hours</option>
                    <option value="48" {% if hours == 48 %}selected{% endif %}>Last 48 hours</option>
                    <option value="168" {% if hours == 168 %}selected{% endif %}>Last 7 days</option>
                    <option value="720" {% if hours == 720 %}selected{% endif %}>Last 30 days</option>
                </select>
                <script>
                function updateFilters() {
                    const source = document.getElementById('source-filter') ? document.getElementById('source-filter').value : '';
                    const hours = document.getElementById('hours-filter').value;
                    let url = '?hours=' + hours;
                    if (source) url += '&source=' + encodeURIComponent(source);
                    window.location.href = url;
                }
                </script>
            </div>
            <a href="{{ url_for('index', hours=hours) }}" class="btn">Back to Dashboard</a>
        </div>
    </div>

    <div class="info-box" style="margin: 20px 0;">
        <p>{{ countries | length }} countries detected</p>
    </div>

    <table class="data-table sortable">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Country</th>
                <th>Sessions</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for country, count in countries %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ country }}</td>
                <td>{{ count }}</td>
                <td>
                    <a href="{{ url_for('sessions', country=country, hours=hours) }}" class="btn btn-sm">View Sessions</a>
                    <a href="{{ url_for('ip_list', country=country, hours=hours) }}" class="btn btn-sm">View IPs</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" class="no-data">No countries recorded</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
